<!DOCTYPE html>
<html lang="en">

<head>


  <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <base href="/">
    <title>Project Madurai School</title>

    
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/images/favicon-16x16.png"
    />
    <link rel="manifest" href="/images/site.webmanifest" />

    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />


    

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
      integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ="
      crossorigin="anonymous"
    />



  


</head>

<body>
  <main class="container mt-5 w-100 h-100">
    <nav class="navbar navbar-expand-md navbar-light bg-white py-0 fixed-top">
  <div class="container-fluid border-bottom border-top-1 shadow-sm bg-body">
    <a class="navbar-brand lh-1" href="/">
      
      
        <span class="text-primary"><strong>Project Madurai</strong></span><br>
        <p class="text-muted text-end w-100 p-0 mb-0"><small class="dropdown-toggle">தமிழ்</small></p>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExampleDefault"
      aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" href="/books/javascript">Javascript</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/books/c">C</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/practices/java">Java</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/posts">Blog</a>
        </li>
      </ul>
      <form class="d-flex">
        <input class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>
      <ul class="navbar-nav secured">
        <li class="nav-item btn pe-0">
          <a class="nav-link" href="/chat"><i class="far fa-comment-dots fa-2x"></i></a>
        </li>
        <li class="nav-item pe-0 dropdown">
          
          <div class="btn-group bg-light">
            <a class="btn btn-toggle pe-0" data-bs-toggle="dropdown" aria-expanded="false">
              <div class="d-flex bd-highlight">
                <div class="w-100 bd-highlight text-end">
                  <h6 class="text-muted fw-bold">தமிழ்ச் சங்கம்</h6>
                  <small class="text-muted">திருவள்ளுவர் கழகம்</small>
               </div>
                <div class="flex-shrink-1 bd-highlight">
                  <img src="http://ssl.gstatic.com/accounts/ui/avatar_2x.png" class="img-circle img-thumbnail avatar"
                style="vertical-align: middle;border-radius: 50%; width: 3rem; margin-right: 10px;" alt="avatar">
                </div>
                
                
              </div>
            </a>
            <ul class="dropdown-menu" aria-labelledby="dropdown03">
              <li><a class="dropdown-item" href="javascript://">Profile</a></li>
              <li><a class="dropdown-item" href="/campuses/tamil-sangam">Campus</a></li>
              <li><a class="dropdown-item logout" href="javascript://">Logout</a></li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="row py-5 w-100 h-100">
       

  <nav class="navbar border-1 border-bottom">
  <div class="row w-100">
    <div class="col-4">
      <a href="/books/javascript/promises-async-await/micro-task-queue">Microtasks</a>
    </div>
    <div class="col-4 mb-2 text-center">
      <a class="text-dark"
        href="/books/javascript/promises-async-await">Promises, async/await</a>
    </div>
    <div class="col-4 d-flex justify-content-end align-items-center">
      
    </div>
  </div>
</nav>

<main id="content" class="pt-3"><h1 id="asyncawait">Async/await</h1>
<p>There&rsquo;s a special syntax to work with promises in a more comfortable fashion, called &ldquo;async/await&rdquo;. It&rsquo;s surprisingly easy to understand and use.</p>
<h2 id="async-functions">Async functions</h2>
<p>Let&rsquo;s start with the <code>async</code> keyword. It can be placed before a function, like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
  }

</code></pre></div><p>The word &ldquo;async&rdquo; before a function means one simple thing: a function always returns a promise. Other values are wrapped in a resolved promise automatically.</p>
<p>For instance, this function returns a resolved promise with the result of <code>1</code>; let&rsquo;s test it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
  }

  <span style="color:#a6e22e">f</span>().<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">alert</span>); <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>
</code></pre></div><p>&hellip;We could explicitly return a promise, which would be the same:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
    <span style="color:#66d9ef">return</span> Promise.<span style="color:#a6e22e">resolve</span>(<span style="color:#ae81ff">1</span>);
  }

  <span style="color:#a6e22e">f</span>().<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">alert</span>); <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>
</code></pre></div><p>So, <code>async</code> ensures that the function returns a promise, and wraps non-promises in it. Simple enough, right? But not only that. There&rsquo;s another keyword, <code>await</code>, that works only inside <code>async</code> functions, and it&rsquo;s pretty cool.</p>
<h2 id="await">Await</h2>
<p>The syntax:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#75715e">// works only inside async functions
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">promise</span>;

</code></pre></div><p>The keyword <code>await</code> makes JavaScript wait until that promise settles and returns its result.</p>
<p>Here&rsquo;s an example with a promise that resolves in 1 second:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {

    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">promise</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
      <span style="color:#a6e22e">setTimeout</span>(() =&gt; <span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#34;done!&#34;</span>), <span style="color:#ae81ff">1000</span>)
    });

  <span style="color:#f92672">*!*</span>
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">promise</span>; <span style="color:#75715e">// wait until the promise resolves (*)
</span><span style="color:#75715e"></span>  <span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>

    <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">result</span>); <span style="color:#75715e">// &#34;done!&#34;
</span><span style="color:#75715e"></span>  }

  <span style="color:#a6e22e">f</span>();

</code></pre></div><p>The function execution &ldquo;pauses&rdquo; at the line <code>(*)</code> and resumes when the promise settles, with <code>result</code> becoming its result. So the code above shows &ldquo;done!&rdquo; in one second.</p>
<p>Let&rsquo;s emphasize: <code>await</code> literally suspends the function execution until the promise settles, and then resumes it with the promise result. That doesn&rsquo;t cost any CPU resources, because the JavaScript engine can do other jobs in the meantime: execute other scripts, handle events, etc.</p>
<p>It&rsquo;s just a more elegant syntax of getting the promise result than <code>promise.then</code>. And, it&rsquo;s easier to read and write.</p>
<blockquote>
<h3 id="-await-in-regular-functions">⚠️ <strong><code>await</code> in regular functions</strong></h3>
<p>If we try to use <code>await</code> in a non-async function, there would be a syntax error:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">promise</span> <span style="color:#f92672">=</span> Promise.<span style="color:#a6e22e">resolve</span>(<span style="color:#ae81ff">1</span>);
<span style="color:#f92672">*!*</span>
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">promise</span>; <span style="color:#75715e">// Syntax error
</span><span style="color:#75715e"></span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
}
</code></pre></div><blockquote>
<p>We may get this error if we forget to put <code>async</code> before a function. As stated earlier, <code>await</code> only works inside an <code>async</code> function.</p>
</blockquote>
<p>Let&rsquo;s take the <code>showAvatar()</code> example from the chapter <a href="info:promise-chaining">info:promise-chaining</a> and rewrite it using <code>async/await</code>:</p>
<ol>
<li>We&rsquo;ll need to replace <code>.then</code> calls with <code>await</code>.</li>
<li>Also we should make the function <code>async</code> for them to work.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">showAvatar</span>() {

    <span style="color:#75715e">// read our JSON
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/article/promise-chaining/user.json&#39;</span>);
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();

    <span style="color:#75715e">// read github user
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">githubResponse</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">`https://api.github.com/users/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">githubUser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">githubResponse</span>.<span style="color:#a6e22e">json</span>();

    <span style="color:#75715e">// show the avatar
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">img</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;img&#39;</span>);
    <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">githubUser</span>.<span style="color:#a6e22e">avatar_url</span>;
    <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;promise-avatar-example&#34;</span>;
    document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">append</span>(<span style="color:#a6e22e">img</span>);

    <span style="color:#75715e">// wait 3 seconds
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; <span style="color:#a6e22e">setTimeout</span>(<span style="color:#a6e22e">resolve</span>, <span style="color:#ae81ff">3000</span>));

    <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">remove</span>();

    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">githubUser</span>;
  }

  <span style="color:#a6e22e">showAvatar</span>();

</code></pre></div><p>Pretty clean and easy to read, right? Much better than before.</p>
<blockquote>
<h3 id="ℹ-await-wont-work-in-the-top-level-code">ℹ️ <strong><code>await</code> won&rsquo;t work in the top-level code</strong></h3>
<p>People who are just starting to use <code>await</code> tend to forget the fact that we can&rsquo;t use <code>await</code> in top-level code. For example, this will not work:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// syntax error in top-level code
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/article/promise-chaining/user.json&#39;</span>);
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
</code></pre></div><p>But we can wrap it into an anonymous async function, like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  (<span style="color:#66d9ef">async</span> () =&gt; {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/article/promise-chaining/user.json&#39;</span>);
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
    ...
  })();

</code></pre></div><p>P.S. New feature: starting from V8 engine version 8.9+, top-level await works in <a href="info:modules">modules</a>.</p>
<blockquote>
<h3 id="ℹawait-accepts-thenables"><strong>ℹ️<code>await</code> accepts &quot;thenables&quot;</strong></h3>
<p>Like <code>promise.then</code>, <code>await</code> allows us to use thenable objects (those with a callable <code>then</code> method). The idea is that a third-party object may not be a promise, but promise-compatible: if it supports <code>.then</code>, that&rsquo;s enough to use it with <code>await</code>.</p>
<p>Here&rsquo;s a demo <code>Thenable</code> class; the <code>await</code> below accepts its instances:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Thenable</span> {
    <span style="color:#a6e22e">constructor</span>(<span style="color:#a6e22e">num</span>) {
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">num</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">num</span>;
    }
    <span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) {
      <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">resolve</span>);
      <span style="color:#75715e">// resolve with this.num*2 after 1000ms
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">setTimeout</span>(() =&gt; <span style="color:#a6e22e">resolve</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">num</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">1000</span>); <span style="color:#75715e">// (*)
</span><span style="color:#75715e"></span>    }
  }

  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
    <span style="color:#75715e">// waits for 1 second, then result becomes 2
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Thenable</span>(<span style="color:#ae81ff">1</span>);
    <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">result</span>);
  }

  <span style="color:#a6e22e">f</span>();

</code></pre></div><blockquote>
<p>If <code>await</code> gets a non-promise object with <code>.then</code>, it calls that method providing the built-in functions <code>resolve</code> and <code>reject</code> as arguments (just as it does for a regular <code>Promise</code> executor). Then <code>await</code> waits until one of them is called (in the example above it happens in the line <code>(*)</code>) and then proceeds with the result.</p>
</blockquote>
<blockquote>
<h3 id="ℹ-async-class-methods">ℹ️ <strong>&ldquo;Async class methods&rdquo;</strong></h3>
<p>To declare an async class method, just prepend it with <code>async</code>:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Waiter</span> {
  <span style="color:#f92672">*!*</span>
    <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">wait</span>() {
  <span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> Promise.<span style="color:#a6e22e">resolve</span>(<span style="color:#ae81ff">1</span>);
    }
  }

  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Waiter</span>()
    .<span style="color:#a6e22e">wait</span>()
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">alert</span>); <span style="color:#75715e">// 1 (this is the same as (result =&gt; alert(result)))
</span></code></pre></div><blockquote>
<p>The meaning is the same: it ensures that the returned value is a promise and enables <code>await</code>.</p>
</blockquote>
<h2 id="error-handling">Error handling</h2>
<p>If a promise resolves normally, then <code>await promise</code> returns the result. But in the case of a rejection, it throws the error, just as if there were a <code>throw</code> statement at that line.</p>
<p>This code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
  <span style="color:#f92672">*!*</span>
    <span style="color:#66d9ef">await</span> Promise.<span style="color:#a6e22e">reject</span>(<span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Whoops!&#34;</span>));
  <span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
  }

</code></pre></div><p>&hellip;is the same as this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
  <span style="color:#f92672">*!*</span>
    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Whoops!&#34;</span>);
  <span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
  }

</code></pre></div><p>In real situations, the promise may take some time before it rejects. In that case there will be a delay before <code>await</code> throws an error.</p>
<p>We can catch that error using <code>try..catch</code>, the same way as a regular <code>throw</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {

    <span style="color:#66d9ef">try</span> {
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;http://no-such-url&#39;</span>);
    } <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span>) {
  <span style="color:#f92672">*!*</span>
      <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">err</span>); <span style="color:#75715e">// TypeError: failed to fetch
</span><span style="color:#75715e"></span>  <span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
    }
  }

  <span style="color:#a6e22e">f</span>();

</code></pre></div><p>In the case of an error, the control jumps to the <code>catch</code> block. We can also wrap multiple lines:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {

    <span style="color:#66d9ef">try</span> {
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/no-user-here&#39;</span>);
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
    } <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span>) {
      <span style="color:#75715e">// catches errors both in fetch and response.json
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">err</span>);
    }
  }

  <span style="color:#a6e22e">f</span>();

</code></pre></div><p>If we don&rsquo;t have <code>try..catch</code>, then the promise generated by the call of the async function <code>f()</code> becomes rejected. We can append <code>.catch</code> to handle it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">f</span>() {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;http://no-such-url&#39;</span>);
  }

  <span style="color:#75715e">// f() becomes a rejected promise
</span><span style="color:#75715e"></span>  <span style="color:#f92672">*!*</span>
  <span style="color:#a6e22e">f</span>().<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">alert</span>); <span style="color:#75715e">// TypeError: failed to fetch // (*)
</span><span style="color:#75715e"></span>  <span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>

</code></pre></div><p>If we forget to add <code>.catch</code> there, then we get an unhandled promise error (viewable in the console). We can catch such errors using a global <code>unhandledrejection</code> event handler as described in the chapter <a href="info:promise-error-handling">info:promise-error-handling</a>.</p>
<blockquote>
<h3 id="ℹ-asyncawait-and-promisethencatch">ℹ️ <strong><code>async/await</code> and <code>promise.then/catch</code></strong></h3>
<p>When we use <code>async/await</code>, we rarely need <code>.then</code>, because <code>await</code> handles the waiting for us. And we can use a regular <code>try..catch</code> instead of <code>.catch</code>. That&rsquo;s usually (but not always) more convenient.</p>
<p>But at the top level of the code, when we&rsquo;re outside any <code>async</code> function, we&rsquo;re syntactically unable to use <code>await</code>, so it&rsquo;s a normal practice to add <code>.then/catch</code> to handle the final result or falling-through error, like in the line <code>(*)</code> of the example above.</p>
</blockquote>
<blockquote>
<h3 id="ℹ-asyncawait-works-well-with-promiseall">ℹ️ <strong><code>async/await</code> works well with <code>Promise.all</code></strong></h3>
<p>When we need to wait for multiple promises, we can wrap them in <code>Promise.all</code> and then <code>await</code>:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">
  <span style="color:#75715e">// wait for the array of results
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">results</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> Promise.<span style="color:#a6e22e">all</span>([
    <span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url1</span>),
    <span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">url2</span>),
    ...
  ]);

</code></pre></div><blockquote>
<p>In the case of an error, it propagates as usual, from the failed promise to <code>Promise.all</code>, and then becomes an exception that we can catch using <code>try..catch</code> around the call.</p>
</blockquote>
<h2 id="summary">Summary</h2>
<p>The <code>async</code> keyword before a function has two effects:</p>
<ol>
<li>Makes it always return a promise.</li>
<li>Allows <code>await</code> to be used in it.</li>
</ol>
<p>The <code>await</code> keyword before a promise makes JavaScript wait until that promise settles, and then:</p>
<ol>
<li>If it&rsquo;s an error, the exception is generated — same as if <code>throw error</code> were called at that very place.</li>
<li>Otherwise, it returns the result.</li>
</ol>
<p>Together they provide a great framework to write asynchronous code that is easy to both read and write.</p>
<p>With <code>async/await</code> we rarely need to write <code>promise.then/catch</code>, but we still shouldn&rsquo;t forget that they are based on promises, because sometimes (e.g. in the outermost scope) we have to use these methods. Also <code>Promise.all</code> is nice when we are waiting for many tasks simultaneously.</p>
</main>


<div class="modal fade" id="noteModel" tabindex="-1" aria-labelledby="noteModelLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="noteModelLabel">Note</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <textarea class="form-control" id="noteText" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>


    </div>
    
  </main>
  
  



<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Confimation</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete ?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
          <button type="button" class="btn btn-primary">Yes</button>
        </div>
      </div>
    </div>
  </div>

<div aria-live="polite" aria-atomic="true">
  <div class="toast-container position-absolute top-0 start-0 p-5 mt-5" id="toast-container">
    
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>
<script type="text/javascript" src="/js/app.js"></script>



  
  
  

<script type="text/javascript" src="/js/chapter.js"></script>


  
</body>

</html>