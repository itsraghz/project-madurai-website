<!DOCTYPE html>
<html lang="en">

<head>


  <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <base href="/">
    <title>Project Madurai School</title>

    
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/images/favicon-16x16.png"
    />
    <link rel="manifest" href="/images/site.webmanifest" />

    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />


    

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"
      integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ="
      crossorigin="anonymous"
    />



  


</head>

<body>
  <main class="container mt-5 w-100 h-100">
    <nav class="navbar navbar-expand-md navbar-light bg-white py-0 fixed-top">
  <div class="container-fluid border-bottom border-top-1 shadow-sm bg-body">
    <a class="navbar-brand lh-1" href="/">
      
      
        <span class="text-primary"><strong>Project Madurai</strong></span><br>
        <p class="text-muted text-end w-100 p-0 mb-0"><small class="dropdown-toggle">தமிழ்</small></p>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExampleDefault"
      aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" href="/books/javascript">Javascript</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/books/c">C</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/practices/java">Java</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/posts">Blog</a>
        </li>
      </ul>
      <form class="d-flex">
        <input class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>
      <ul class="navbar-nav secured">
        <li class="nav-item btn pe-0">
          <a class="nav-link" href="/chat"><i class="far fa-comment-dots fa-2x"></i></a>
        </li>
        <li class="nav-item pe-0 dropdown">
          
          <div class="btn-group bg-light">
            <a class="btn btn-toggle pe-0" data-bs-toggle="dropdown" aria-expanded="false">
              <div class="d-flex bd-highlight">
                <div class="w-100 bd-highlight text-end">
                  <h6 class="text-muted fw-bold">தமிழ்ச் சங்கம்</h6>
                  <small class="text-muted">திருவள்ளுவர் கழகம்</small>
               </div>
                <div class="flex-shrink-1 bd-highlight">
                  <img src="http://ssl.gstatic.com/accounts/ui/avatar_2x.png" class="img-circle img-thumbnail avatar"
                style="vertical-align: middle;border-radius: 50%; width: 3rem; margin-right: 10px;" alt="avatar">
                </div>
                
                
              </div>
            </a>
            <ul class="dropdown-menu" aria-labelledby="dropdown03">
              <li><a class="dropdown-item" href="javascript://">Profile</a></li>
              <li><a class="dropdown-item" href="/campuses/tamil-sangam">Campus</a></li>
              <li><a class="dropdown-item logout" href="javascript://">Logout</a></li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
    <div class="row py-5 w-100 h-100">
       

  <nav class="navbar border-1 border-bottom">
  <div class="row w-100">
    <div class="col-4">
      <a href="/books/javascript/data-types/map-set">Map and Set</a>
    </div>
    <div class="col-4 mb-2 text-center">
      <a class="text-dark"
        href="/books/javascript/data-types">Datatypes</a>
    </div>
    <div class="col-4 d-flex justify-content-end align-items-center">
      <a href="/books/javascript/data-types/keys-values-entries">Object.keys, values, entries</a>
    </div>
  </div>
</nav>

<main id="content" class="pt-3"><h1 id="weakmap-and-weakset">WeakMap and WeakSet</h1>
<p>As we know from the chapter <a href="info:garbage-collection">info:garbage-collection</a>, JavaScript engine keeps a value in memory while it is &ldquo;reachable&rdquo; and can potentially be used.</p>
<p>For instance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;John&#34;</span> };

<span style="color:#75715e">// the object can be accessed, john is the reference to it
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// overwrite the reference
</span><span style="color:#75715e"></span><span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;

<span style="color:#f92672">*!*</span>
<span style="color:#75715e">// the object will be removed from memory
</span><span style="color:#75715e"></span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
</code></pre></div><p>Usually, properties of an object or elements of an array or another data structure are considered reachable and kept in memory while that data structure is in memory.</p>
<p>For instance, if we put an object into an array, then while the array is alive, the object will be alive as well, even if there are no other references to it.</p>
<p>Like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;John&#34;</span> };

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">array</span> <span style="color:#f92672">=</span> [ <span style="color:#a6e22e">john</span> ];

<span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// overwrite the reference
</span><span style="color:#75715e"></span>
<span style="color:#f92672">*!*</span>
<span style="color:#75715e">// the object previously referenced by john is stored inside the array
</span><span style="color:#75715e">// therefore it won&#39;t be garbage-collected
</span><span style="color:#75715e">// we can get it as array[0]
</span><span style="color:#75715e"></span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
</code></pre></div><p>Similar to that, if we use an object as the key in a regular <code>Map</code>, then while the <code>Map</code> exists, that object exists as well. It occupies memory and may not be garbage collected.</p>
<p>For instance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;John&#34;</span> };

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>();
<span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">john</span>, <span style="color:#e6db74">&#34;...&#34;</span>);

<span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// overwrite the reference
</span><span style="color:#75715e"></span>
<span style="color:#f92672">*!*</span>
<span style="color:#75715e">// john is stored inside the map,
</span><span style="color:#75715e">// we can get it by using map.keys()
</span><span style="color:#75715e"></span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
</code></pre></div><p><code>WeakMap</code> is fundamentally different in this aspect. It doesn&rsquo;t prevent garbage-collection of key objects.</p>
<p>Let&rsquo;s see what it means on examples.</p>
<h2 id="weakmap">WeakMap</h2>
<p>The first difference between <code>Map</code> and <code>WeakMap</code> is that keys must be objects, not primitive values:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">weakMap</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>();

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {};

<span style="color:#a6e22e">weakMap</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">obj</span>, <span style="color:#e6db74">&#34;ok&#34;</span>); <span style="color:#75715e">// works fine (object key)
</span><span style="color:#75715e"></span>
<span style="color:#f92672">*!*</span>
<span style="color:#75715e">// can&#39;t use a string as the key
</span><span style="color:#75715e"></span><span style="color:#a6e22e">weakMap</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#34;test&#34;</span>, <span style="color:#e6db74">&#34;Whoops&#34;</span>); <span style="color:#75715e">// Error, because &#34;test&#34; is not an object
</span><span style="color:#75715e"></span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>
</code></pre></div><p>Now, if we use an object as the key in it, and there are no other references to that object &ndash; it will be removed from memory (and from the map) automatically.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;John&#34;</span> };

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">weakMap</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>();
<span style="color:#a6e22e">weakMap</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">john</span>, <span style="color:#e6db74">&#34;...&#34;</span>);

<span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// overwrite the reference
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// john is removed from memory!
</span></code></pre></div><p>Compare it with the regular <code>Map</code> example above. Now if <code>john</code> only exists as the key of <code>WeakMap</code> &ndash; it will be automatically deleted from the map (and memory).</p>
<p><code>WeakMap</code> does not support iteration and methods <code>keys()</code>, <code>values()</code>, <code>entries()</code>, so there&rsquo;s no way to get all keys or values from it.</p>
<p><code>WeakMap</code> has only the following methods:</p>
<ul>
<li><code>weakMap.get(key)</code></li>
<li><code>weakMap.set(key, value)</code></li>
<li><code>weakMap.delete(key)</code></li>
<li><code>weakMap.has(key)</code></li>
</ul>
<p>Why such a limitation? That&rsquo;s for technical reasons. If an object has lost all other references (like <code>john</code> in the code above), then it is to be garbage-collected automatically. But technically it&rsquo;s not exactly specified <em>when the cleanup happens</em>.</p>
<p>The JavaScript engine decides that. It may choose to perform the memory cleanup immediately or to wait and do the cleaning later when more deletions happen. So, technically, the current element count of a <code>WeakMap</code> is not known. The engine may have cleaned it up or not, or did it partially. For that reason, methods that access all keys/values are not supported.</p>
<p>Now, where do we need such a data structure?</p>
<h2 id="use-case-additional-data">Use case: additional data</h2>
<p>The main area of application for <code>WeakMap</code> is an <em>additional data storage</em>.</p>
<p>If we&rsquo;re working with an object that &ldquo;belongs&rdquo; to another code, maybe even a third-party library, and would like to store some data associated with it, that should only exist while the object is alive - then <code>WeakMap</code> is exactly what&rsquo;s needed.</p>
<p>We put the data to a <code>WeakMap</code>, using the object as the key, and when the object is garbage collected, that data will automatically disappear as well.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">weakMap</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">john</span>, <span style="color:#e6db74">&#34;secret documents&#34;</span>);
<span style="color:#75715e">// if john dies, secret documents will be destroyed automatically
</span></code></pre></div><p>Let&rsquo;s look at an example.</p>
<p>For instance, we have code that keeps a visit count for users. The information is stored in a map: a user object is the key and the visit count is the value. When a user leaves (its object gets garbage collected), we don&rsquo;t want to store their visit count anymore.</p>
<p>Here&rsquo;s an example of a counting function with <code>Map</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 📁 visitsCount.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">visitsCountMap</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>(); <span style="color:#75715e">// map: user =&gt; visits count
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// increase the visits count
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">countUser</span>(<span style="color:#a6e22e">user</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">visitsCountMap</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">user</span>) <span style="color:#f92672">||</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#a6e22e">visitsCountMap</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
}
</code></pre></div><p>And here&rsquo;s another part of the code, maybe another file using it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 📁 main.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;John&#34;</span> };

<span style="color:#a6e22e">countUser</span>(<span style="color:#a6e22e">john</span>); <span style="color:#75715e">// count his visits
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// later john leaves us
</span><span style="color:#75715e"></span><span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</code></pre></div><p>Now, <code>john</code> object should be garbage collected, but remains in memory, as it&rsquo;s a key in <code>visitsCountMap</code>.</p>
<p>We need to clean <code>visitsCountMap</code> when we remove users, otherwise it will grow in memory indefinitely. Such cleaning can become a tedious task in complex architectures.</p>
<p>We can avoid it by switching to <code>WeakMap</code> instead:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 📁 visitsCount.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">visitsCountMap</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>(); <span style="color:#75715e">// weakmap: user =&gt; visits count
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// increase the visits count
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">countUser</span>(<span style="color:#a6e22e">user</span>) {
  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">visitsCountMap</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">user</span>) <span style="color:#f92672">||</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#a6e22e">visitsCountMap</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">count</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
}
</code></pre></div><p>Now we don&rsquo;t have to clean <code>visitsCountMap</code>. After <code>john</code> object becomes unreachable, by all means except as a key of <code>WeakMap</code>, it gets removed from memory, along with the information by that key from <code>WeakMap</code>.</p>
<h2 id="use-case-caching">Use case: caching</h2>
<p>Another common example is caching. We can store (&ldquo;cache&rdquo;) results from a function, so that future calls on the same object can reuse it.</p>
<p>To achieve that, we can use <code>Map</code> (not optimal scenario):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 📁 cache.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">cache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Map</span>();

<span style="color:#75715e">// calculate and remember the result
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">obj</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">has</span>(<span style="color:#a6e22e">obj</span>)) {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#75715e">/* calculations of the result for */</span> <span style="color:#a6e22e">obj</span>;

    <span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">obj</span>, <span style="color:#a6e22e">result</span>);
  }

  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">obj</span>);
}

<span style="color:#f92672">*!*</span>
<span style="color:#75715e">// Now we use process() in another file:
</span><span style="color:#75715e"></span><span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>

<span style="color:#75715e">// 📁 main.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {<span style="color:#75715e">/* let&#39;s say we have an object */</span>};

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">obj</span>); <span style="color:#75715e">// calculated
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ...later, from another place of the code...
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">obj</span>); <span style="color:#75715e">// remembered result taken from cache
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ...later, when the object is not needed any more:
</span><span style="color:#75715e"></span><span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;

<span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">size</span>); <span style="color:#75715e">// 1 (Ouch! The object is still in cache, taking memory!)
</span></code></pre></div><p>For multiple calls of <code>process(obj)</code> with the same object, it only calculates the result the first time, and then just takes it from <code>cache</code>. The downside is that we need to clean <code>cache</code> when the object is not needed any more.</p>
<p>If we replace <code>Map</code> with <code>WeakMap</code>, then this problem disappears. The cached result will be removed from memory automatically after the object gets garbage collected.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 📁 cache.js
</span><span style="color:#75715e"></span><span style="color:#f92672">*!*</span>
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">cache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakMap</span>();
<span style="color:#f92672">*</span><span style="color:#960050;background-color:#1e0010">/!*</span>

<span style="color:#75715e">// calculate and remember the result
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">obj</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">has</span>(<span style="color:#a6e22e">obj</span>)) {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#75715e">/* calculate the result for */</span> <span style="color:#a6e22e">obj</span>;

    <span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">obj</span>, <span style="color:#a6e22e">result</span>);
  }

  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cache</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">obj</span>);
}

<span style="color:#75715e">// 📁 main.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {<span style="color:#75715e">/* some object */</span>};

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">obj</span>);
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">result2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>(<span style="color:#a6e22e">obj</span>);

<span style="color:#75715e">// ...later, when the object is not needed any more:
</span><span style="color:#75715e"></span><span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;

<span style="color:#75715e">// Can&#39;t get cache.size, as it&#39;s a WeakMap,
</span><span style="color:#75715e">// but it&#39;s 0 or soon be 0
</span><span style="color:#75715e">// When obj gets garbage collected, cached data will be removed as well
</span></code></pre></div><h2 id="weakset">WeakSet</h2>
<p><code>WeakSet</code> behaves similarly:</p>
<ul>
<li>It is analogous to <code>Set</code>, but we may only add objects to <code>WeakSet</code> (not primitives).</li>
<li>An object exists in the set while it is reachable from somewhere else.</li>
<li>Like <code>Set</code>, it supports <code>add</code>, <code>has</code> and <code>delete</code>, but not <code>size</code>, <code>keys()</code> and no iterations.</li>
</ul>
<p>Being &ldquo;weak&rdquo;, it also serves as additional storage. But not for arbitrary data, rather for &ldquo;yes/no&rdquo; facts. A membership in <code>WeakSet</code> may mean something about the object.</p>
<p>For instance, we can add users to <code>WeakSet</code> to keep track of those who visited our site:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">visitedSet</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WeakSet</span>();

<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;John&#34;</span> };
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pete</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Pete&#34;</span> };
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">mary</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Mary&#34;</span> };

<span style="color:#a6e22e">visitedSet</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">john</span>); <span style="color:#75715e">// John visited us
</span><span style="color:#75715e"></span><span style="color:#a6e22e">visitedSet</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">pete</span>); <span style="color:#75715e">// Then Pete
</span><span style="color:#75715e"></span><span style="color:#a6e22e">visitedSet</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">john</span>); <span style="color:#75715e">// John again
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// visitedSet has 2 users now
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// check if John visited?
</span><span style="color:#75715e"></span><span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">visitedSet</span>.<span style="color:#a6e22e">has</span>(<span style="color:#a6e22e">john</span>)); <span style="color:#75715e">// true
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// check if Mary visited?
</span><span style="color:#75715e"></span><span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">visitedSet</span>.<span style="color:#a6e22e">has</span>(<span style="color:#a6e22e">mary</span>)); <span style="color:#75715e">// false
</span><span style="color:#75715e"></span>
<span style="color:#a6e22e">john</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;

<span style="color:#75715e">// visitedSet will be cleaned automatically
</span></code></pre></div><p>The most notable limitation of <code>WeakMap</code> and <code>WeakSet</code> is the absence of iterations, and the inability to get all current content. That may appear inconvenient, but does not prevent <code>WeakMap/WeakSet</code> from doing their main job &ndash; be an &ldquo;additional&rdquo; storage of data for objects which are stored/managed at another place.</p>
<h2 id="summary">Summary</h2>
<p><code>WeakMap</code> is <code>Map</code>-like collection that allows only objects as keys and removes them together with associated value once they become inaccessible by other means.</p>
<p><code>WeakSet</code> is <code>Set</code>-like collection that stores only objects and removes them once they become inaccessible by other means.</p>
<p>Their main advantages are that they have weak reference to objects, so they can easily be removed by garbage collector.</p>
<p>That comes at the cost of not having support for <code>clear</code>, <code>size</code>, <code>keys</code>, <code>values</code>&hellip;</p>
<p><code>WeakMap</code> and <code>WeakSet</code> are used as &ldquo;secondary&rdquo; data structures in addition to the &ldquo;primary&rdquo; object storage. Once the object is removed from the primary storage, if it is only found as the key of <code>WeakMap</code> or in a <code>WeakSet</code>, it will be cleaned up automatically.</p>
</main>


<div class="modal fade" id="noteModel" tabindex="-1" aria-labelledby="noteModelLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="noteModelLabel">Note</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <textarea class="form-control" id="noteText" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>


    </div>
    
  </main>
  
  



<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Confimation</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete ?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
          <button type="button" class="btn btn-primary">Yes</button>
        </div>
      </div>
    </div>
  </div>

<div aria-live="polite" aria-atomic="true">
  <div class="toast-container position-absolute top-0 start-0 p-5 mt-5" id="toast-container">
    
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>
<script type="text/javascript" src="/js/app.js"></script>



  
  
  

<script type="text/javascript" src="/js/chapter.js"></script>


  
</body>

</html>